<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Website</title>
  <link rel="stylesheet" href="/stylesheets/styles.css">
  <link rel="stylesheet" href="/stylesheets/others.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://kit.fontawesome.com/bbe06e3f12.js" crossorigin="anonymous"></script>
  <script src="/App.js" defer></script>
  <script>
    function get_branch_information() {
    let xhttp = new XMLHttpRequest();

    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var responseJSON = JSON.parse(this.responseText);

        console.log(this.responseText);
        console.log(responseJSON);

        var statistic_element;

        statistic_element = document.getElementById('branch-name');
        statistic_element.innerText = responseJSON.branch_name;

        statistic_element = document.getElementById('num-branch-members');
        statistic_element.innerText = responseJSON.num_branch_members;

        statistic_element = document.getElementById('num-upcoming-events');
        statistic_element.innerText = responseJSON.num_upcoming_events;

        statistic_element = document.getElementById('num-total-events');
        statistic_element.innerText = responseJSON.num_total_events;

        statistic_element = document.getElementById('upcoming-events');
        statistic_element.innerHTML = "";
        for (let i = 0; i < responseJSON.upcoming_events.length; i++) {
          statistic_element.innerHTML += `
            <div class="dashboard-container">
                <p>
                  <a href=/events/id/${responseJSON.upcoming_events[i].event_id}> <b> ${responseJSON.upcoming_events[i].event_name} </b> </a>
                  &emsp;
                  (<u>Date:</u> ${responseJSON.upcoming_events[i].start_date_time})
                </p>
            </div>`;
        }

        statistic_element = document.getElementById('other-managers');
        statistic_element.innerHTML = "";
        for (let i = 0; i < responseJSON.other_branch_managers.length; i++) {
          statistic_element.innerHTML += `
            <div class="dashboard-container">
                <p>
                  <b> ${responseJSON.other_branch_managers[i].first_name} ${responseJSON.other_branch_managers[i].last_name} </b>
                  &emsp;
                  (<u>Email:</u> ${responseJSON.other_branch_managers[i].email})
                  &emsp;
                  (<u>Phone:</u> ${responseJSON.other_branch_managers[i].phone_num})
                </p>
            </div>`;
        }
      }
    }

    var branchID = window.location.pathname.split('/')[4];
    xhttp.open("GET", "/manage/branch_information?id=" + branchID, true);
    xhttp.send();
  }
  </script>
</head>

<body id="app" onload="get_branch_information()">
  <header class="top-pane">
    <nav>
      <a class=nav-link v-for="item in navitems" :key="item.title" :href="item.url">{{ item.title }}</a>
    </nav>
  </header>

  <div class="page-content content">
    <div class="right text-center manage-side-pane">
      <h3> Quick Manager Actions </h3>
      <p> <b> Branch: </b> <span id="branch-name"> Location </span> </p>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/manage/branches/id/1/view_members"><b>Manage/View Branch Members</b></a></div>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/manage/events/create"><b>Create New Event </b></a></div>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/manage/news/create"><b>Create News Update </b></a></div>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/events"><b>Manage/View Events </b></a></div>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/branches/id/1"><b>Manage/View Branch Details </b></a></div>
      <h3> Account </h3>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/"><b> Update Profile </b></a></div>
      <div class="center text-center manage-side-pane-container"><a class="text-white" href="/"><b> Sign Out </b></a></div>
    </div>

    <h1> Manager Dashboard</h1>

    <h2> Branch Statistics </h2>

    <div class="statistics-container">
      <div class="statistics-item">
        <b> Total Branch Members: </b>
        <br>
        <p id="num-branch-members"></p>
      </div>
      <div class="statistics-item">
        <b> Total Upcoming Events: </b>
        <br>
        <p id="num-upcoming-events"></p>
      </div>
      <div class="statistics-item">
        <b> Total Branch Events: </b>
        <br>
        <p id="num-total-events"></p>
      </div>
    </div>

    <h2> Upcoming Branch Events </h2>
    <div id="upcoming-events">
      <p> Loading... </p>
    </div>

    <h2> Other Branch Managers </h2>
    <div id="other-managers">
      <p> Loading... </p>
    </div>
  </div>
  <br>
  <br>

  <footer>
    &copy; 2024 Your Website. All rights reserved.
    These buttons will be removed, for testing purposes only
    <button type="button" v-on:click="access_level=0"> Visitor </button>
    <button type="button" v-on:click="access_level=1"> User </button>
    <button type="button" v-on:click="access_level=2"> Manager </button>
  </footer>
</body>

</html>